<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Renovaci√≥n de Comercio</title>
  <link rel="stylesheet" href="../styles/bromatologia.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../styles/renovacion-comercios.css">
</head>

<body class="dashboard-body">
  <div class="dashboard">
    <div class="sidebar">
      <div class="user-info">
        <img src="../img/empleado.png" alt="Empleado" />
        <div class="user-data">
          <h3></h3>
          <p></p>
        </div>
        <button class="logout-btn">Cerrar sesi√≥n</button>
      </div>
    </div>

    <div class="main-panel">
      <div class="header-container">
        <a href="../pages/panel-principal.html" class="logo-calidad">
          <img src="../img/logo-calidad.png" alt="Logo Calidad de Vida">
        </a>
        <div class="header">
          <h2>Formulario</h2>
        </div>
      </div>

      <div class="titulo-contenedor">
        <div class="titulo-area">
          <h1><i class="fas fa-store"></i> Renovaci√≥n de Comercios</h1>
        </div>
      </div>

      <div class="contenedor-blanco">

        <form id="formRenovacionComercio" novalidate>

          <div class="card mb-4">
            <div class="card-header" style="background: linear-gradient(to bottom, #c0a6dd, #655577); color:#fff;">
              <h5>Datos Generales</h5>
            </div>
            <div class="card-body">
              <div class="row g-3 align-items-end">
                <div class="col-md-3" id="campoHabilitacion">
                  <label for="idComercio" class="form-label">N¬∞ de habilitaci√≥n *</label>
                  <div class="input-group">

                    <!-- üÜï Bot√≥n RESET -->
                    <button class="btn btn-success" type="button" id="btnResetComercio">
                      <i class="fas fa-undo" style="color:white;"></i>
                    </button>

                    <input type="text" class="form-control min-hab-input" id="idComercio" placeholder="Ej: 1052"
                      required>

                    <button class="btn btn-outline-primary" type="button" id="btnBuscarComercio">
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                </div>

                <div class="col-md-6">
                  <label for="categoriaComercio" class="form-label">Categor√≠a</label>
                  <input type="text" class="form-control" id="categoriaComercio" readonly>
                </div>
              </div>
            </div>

            <hr class="mt-3 mb-1">

            <!-- DATOS DEL TITULAR / EMPRESA -->
            <div class="card-body">
              <div id="bloqueTitular">
                <h5 class="mb-3" id="tituloBloquePersona">Datos del Titular</h5>
                <div class="row g-3">
                  <div class="col-md-2">
                    <label for="tipoPersona" class="form-label">Persona</label>
                    <input type="text" class="form-control" id="tipoPersona" readonly>
                  </div>
                  <div class="col-md-4">
                    <label for="docIdentidad" class="form-label">DNI </label>
                    <input type="text" class="form-control" id="docIdentidad" readonly>
                  </div>
                  <div class="col-md-6">
                    <label for="nombreRazon" class="form-label">Nombre y Apellido </label>
                    <input type="text" class="form-control" id="nombreRazon" readonly>
                  </div>
                </div>
              </div>
            </div>

            <hr id="lineaAntesRepresentante" class="mt-3 mb-1">

            <div class="card-body">
              <div id="bloqueRepresentante">
                <h5 class="mb-3">Representante Legal</h5>
                <div class="row g-3">
                  <div class="col-md-4">
                    <label for="dni_representante" class="form-label">DNI </label>
                    <input type="text" class="form-control" id="dni_representante" name="dni_representante">
                  </div>
                  <div class="col-md-6">
                    <label for="nombreRepresentante" class="form-label">Nombre y Apellido</label>
                    <input type="text" class="form-control" id="nombreRepresentante">
                  </div>
                </div>
              </div>
            </div>

            <hr class="mt-3 mb-1">

            <div class="card-body">
              <div id="bloqueContacto">
                <div class="row g-3">
                  <div class="col-md-2">
                    <label for="cod_area_representante" class="form-label">C. √°rea </label>
                    <input type="text" class="form-control" id="cod_area_representante" name="cod_area_representante">
                    <div class="invalid-feedback">Ingrese un c√≥digo de √°rea v√°lido (2‚Äì4 d√≠gitos).</div>
                  </div>

                  <div class="col-md-4">
                    <label for="telefono_representante" class="form-label">N. tel√©fono </label>
                    <input type="text" class="form-control" id="telefono_representante" name="telefono_representante">
                    <div class="invalid-feedback">Ingrese un n√∫mero v√°lido.</div>
                  </div>

                  <div class="col-md-5">
                    <label for="correo_representante" class="form-label">Correo electr√≥nico </label>
                    <input type="email" class="form-control" id="correo_representante" name="correo_representante">
                  </div>
                </div>
              </div>
            </div>

            <hr class="mt-3 mb-1">

            <!-- DATOS DEL COMERCIO -->
            <div class="card-body">
              <div id="datosComercio">
                <h5 class="mb-3" id="tituloBloquePersona">Datos del Comercio</h5>

                <!-- Rubro Principal y N¬∞ de sucursal -->
                <div class="row g-3 mb-4">
                  <!-- Rubro Principal -->
                  <div class="col-md-6">
                    <label for="rubro" class="form-label">Rubro Principal</label>
                    <input type="text" class="form-control" id="rubro" readonly>
                  </div>
                  <div class="col-md-2">
                    <label for="numeroSucursal" class="form-label">N¬∞ sucursal</label>
                    <input type="text" class="form-control" id="numeroSucursal" required>
                  </div>
                </div>

                <!-- Anexos de Rubros -->
                <div class="col-10 mb-4" id="anexosContainer">
                  <label class="form-label">Rubros Adicionales (opcional)</label>
                  <div class="row g-2 mb-3" id="anexo1Group">
                    <div class="col-md-10">
                      <select class="form-select anexo-select" id="anexo1">
                        <option value="" selected disabled>Seleccione un rubro adicional</option>
                      </select>
                    </div>
                    <div class="col-md-2">
                      <button type="button" class="btn btn-outline-primary w-100" onclick="removeAnexo(1)">
                        <i class="fas fa-times"></i> Eliminar
                      </button>
                    </div>
                  </div>
                  <button type="button" class="btn btn-outline-primary btn-sm" id="btnAddAnexo">
                    <i class="fas fa-plus"></i> Agregar otro rubro
                  </button>
                </div>

                <!-- Nombre Comercial y Direcci√≥n (fila limpia como en Alta) -->
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="nombreComercial" class="form-label">Nombre Comercial</label>
                    <input type="text" class="form-control" id="nombreComercial" required>
                  </div>

                  <div class="col-md-6">
                    <label for="direccion" class="form-label">Direcci√≥n *</label>
                    <input type="text" class="form-control" id="direccion" required>
                    <div class="invalid-feedback">Por favor ingrese la direcci√≥n.</div>
                  </div>
                </div>

                <!-- Ubicaci√≥n en Mapa y Tel√©fono -->
                <div class="row g-3 mb-3">
                  <div class="col-md-6">
                    <label for="ubicacion" class="form-label">Ubicaci√≥n (Google Maps) *</label>
                    <div class="input-group mb-2">
                      <input type="text" class="form-control" id="ubicacion"
                        placeholder="Pegue aqu√≠ el enlace de Google Maps" required>
                      <button type="button" class="btn btn-outline-primary" id="btnBuscarMapa">
                        <i class="fas fa-map-marked-alt"></i> Buscar en Maps
                      </button>
                    </div>
                    <div id="miniMapa" class="ratio ratio-16x9 mt-2 d-none">
                      <!-- Aqu√≠ se mostrar√° el mini mapa -->
                    </div>
                    <small class="text-muted">Haga clic en el bot√≥n para buscar la ubicaci√≥n en Google Maps</small>
                  </div>

                  <div class="col-md-2">
                    <label for="cod_area_comercio" class="form-label">C. √°rea *</label>
                    <input type="text" class="form-control" id="cod_area_comercio" maxlength="4" required>
                    <div class="invalid-feedback">Ingrese un c√≥digo de √°rea v√°lido (2‚Äì4 d√≠gitos).</div>
                  </div>

                  <div class="col-md-4">
                    <label for="telefono_comercio" class="form-label">N¬∫ tel√©fono *</label>
                    <input type="text" class="form-control" id="telefono_comercio" required>
                    <div class="invalid-feedback">Ingrese un n√∫mero v√°lido.</div>
                  </div>
                  <!-- Correo Electr√≥nico -->
                  <div class="col-md-5">
                    <label for="correoElectronico" class="form-label">Correo Electr√≥nico *</label>
                    <input type="email" class="form-control" id="correoElectronico" required>
                    <div class="invalid-feedback">
                      Por favor ingrese un correo electr√≥nico v√°lido.
                    </div>
                  </div>

                  <!-- Metros Cuadrados -->
                  <div class="col-md-3" id="filaMetros">
                    <label for="metrosCuadrados" class="form-label">M¬≤ *</label>
                    <input type="number" class="form-control" id="metrosCuadrados" min="1" step="0.01" required>
                    <div class="invalid-feedback">
                      Por favor ingrese los metros cuadrados.
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <hr class="mt-0 mb-1">

            <!-- MONTOS Y PAGOS -->
            <div class="card-body">
              <h5 class="mb-3">Montos y Pagos</h5>
              <div class="row g-3 mb-3">
                <div class="col-md-4 montos-generales">
                  <label for="montoSellado" class="form-label">Monto Sellado</label>
                  <input type="text" class="form-control" id="montoSellado" readonly>
                </div>
                <div class="col-md-4 montos-generales">
                  <label for="montoInspeccion" class="form-label">Inspecci√≥n Ocular</label>
                  <input type="text" class="form-control" id="montoInspeccion" readonly>
                </div>
                <div class="col-md-4 montos-generales">
                  <label for="montoTotal" class="form-label">Monto Total</label>
                  <input type="text" class="form-control fw-bold" id="montoTotal" readonly>
                </div>

                <!-- Para vendedores ambulantes / food truck -->
                <div class="col-md-6 montos-ambulante d-none">
                  <label for="montoAmbulante" class="form-label">Monto a pagar</label>
                  <div class="input-group">
                    <input type="text" class="form-control fw-bold" id="montoAmbulante" readonly>
                    <span class="input-group-text" id="montoAmbulanteLeyenda"></span>
                  </div>
                </div>
              </div>
            </div>


            <!-- üü£ DOCUMENTACI√ìN -->
            <div class="card mb-4">
              <div class="card-header" style="background: linear-gradient(to bottom, #c0a6dd, #655577); color:#fff;">
                <h5>Documentaci√≥n del Comercio</h5>
              </div>
              <div class="card-body">
                <div class="row g-3" id="contenedorDocComercio">
                  <p class="text-muted">Las miniaturas de los documentos actuales aparecer√°n aqu√≠ con opci√≥n de
                    renovaci√≥n (‚Üª).</p>
                </div>
              </div>
            </div>

            <div id="contenedorChequeoComercio" class="text-center mt-3">
              <div id="avisoNoModificadosComercio" style="display:none;"></div>
              <div id="flechaAvisoComercio" style="display:none;"></div>

              <button id="btnChequearDatosComercio" type="button" class="btn btn-success">
                <i class="fas fa-check-circle"></i> Chequear datos
              </button>
            </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal inicial de aviso -->
  <div class="modal fade" id="modalAdvertencia" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="modalAdvertenciaLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius: 10px; overflow: hidden;">
        <div class="modal-header" style="background-color: #6b538f; color: #fff;">
          <h5 class="modal-title" id="modalAdvertenciaLabel">Renovaci√≥n de Comercios</h5>
        </div>
        <div class="modal-body text-center" style="font-size: 16px; color: #333;">
          Ingrese por favor un n√∫mero de habilitaci√≥n para poder operar.
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn" id="btnAceptarModal" data-bs-dismiss="modal"
            style="background-color: #2f7d45; color: #fff; font-weight: 500;">
            Aceptar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Validaci√≥n Naranja -->
  <div class="modal fade" id="modalNaranjaComercio" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <!-- Franja NARANJA -->
        <div class="modal-header modal-header-naranja">
          <h5 class="modal-title">Renovaci√≥n de comercio</h5>
        </div>

        <!-- Cuerpo -->
        <div class="modal-body text-center">
          <p class="mb-0">Verifique si no debe renovar estos campos</p>
        </div>

        <!-- Footer -->
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn" id="btnAceptarModal" data-bs-dismiss="modal"
            style="background-color: #2f7d45; color: #fff; font-weight: 500;">
            Aceptar
          </button>
        </div>

      </div>
    </div>
  </div>


  <!-- === Modal de PREVISUALIZACI√ìN RENOVACI√ìN (id√©ntico al alta) === -->
  <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 10px; overflow: hidden;">
        <div class="modal-header" style="background-color: #655577; color: #fff;">
          <h5 class="modal-title">Resumen de la Renovaci√≥n del Comercio</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            style="filter: invert(1);"></button>
        </div>
        <div class="modal-body" id="previewContent" style="padding: 20px;">
          <!-- Contenido generado din√°micamente -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Volver</button>
          <button type="button" class="btn btn-success" id="btnConfirmarModal">Confirmar renovaci√≥n</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/renovacion-comercios.js"></script>
  <script type="module">
    import { checkAuth, infoUsuario } from '../auth.js';
    const userData = checkAuth();
    if (userData) {
      infoUsuario(userData);
      document.querySelector('.logout-btn')?.addEventListener('click', () => {
        localStorage.removeItem('token');
        window.location.href = 'login.html';
      });
    }
  </script>

</body>

</html>